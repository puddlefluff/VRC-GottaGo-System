= VRC Bladder System
:icons: font
:toc:

== To Be Decided

* release animation max length
* audio queues

== TODOs

=== EZL

. Reset the animator node timings to what they were before debugging.
. Fix manual bladder release state reset


== Timing

TODO

fill rate is 1ml per second, meaning a maximum of 600s (10 min) to fill.

== Development Notes (Draft)


=== Layers

==== `sys.0.lock`

Parameter persistence layer and constant state layer.

*TODO*: Rename this, it is just constant state maintenance, not only param
persistence.


==== `sys.1.ux`

System loop, updates parameter values based on system state.


==== `animate.bladder.empty`

Avatar animation layer.


=== Parameters

==== Synchronized Avatar Parameters

* <<param-emptying>>
* <<param-fill-percent>>


[#param-emptying]
===== `bladder.emptying`

[cols=">1h,1m"]
|===
| Type             | bool
| Interaction     a| Button (not Toggle)
| User Modifiable  | 游릴 true
| Synchronized     | 游릴 true
| Expression Param | 游릴 true
|===

Flag indicating whether the player's bladder is currently emptying.

A value of `true` indicates the bladder is emptying, while `false` indicates the
bladder is filling.

This parameter may be manually toggled to trigger a manual/intentional emptying
of the bladder.


[#param-fill-percent]
===== `bladder.fill.percent`

[cols=">1h,1m"]
|===
| Type             | float
| User Modifiable  | 游린 false
| Synchronized     | 游릴 true
| Expression Param | 游릴 true
|===

Bladder fill volume represented as a percentage of 600ml.

The player's selected bladder capacity will determine the maximum value that
this parameter can reach.  For example, given a max capacity of 5%, this
parameter will never go above `0.3`.

[IMPORTANT]
This value MUST not be directly modified by any means outside of the bladder
system's animation controller.


==== Unsynced Avatar Parameters

* <<param-capacity>>
* <<param-radial>>


[#param-capacity]
===== `bladder.capacity`

[cols=">1h,1m"]
|===
| Type             | float
| Interaction     a| Radial
| User Modifiable  | 游릴 true
| Synchronized     | 游린 false
| Expression Param | 游릴 true
|===

The player's chosen bladder capacity.

A value of `0` disables the bladder system entirely.

Values greater than `0` set the bladder capacity to a percentage of a max
capacity of 600ml.

This value also directly controls the time, as the bladder fill rate is 1ml per
second.


[#param-radial]
===== `bladder.radial.open`

[cols=">1h,1m"]
|===
| Type             | bool
| Interaction     a| Indirect
| User Modifiable  | 游릴 true
| Synchronized     | 游린 false
| Expression Param | 游릴 true
|===


==== Internal System Parameters

* <<param-const-1>>
* <<param-countdown>>
* <<param-fill-internal>>
* <<param-state>>

[#param-const-1]
===== `sys.bladder.const.1`

[cols=">1h,1m"]
|===
| Type             | float
| User Modifiable  | 游린 false
| Synchronized     | 游린 false
| Expression Param | 游린 false
|===

Constant value `1.0`, used in blend tree arithmetic.

[#param-countdown]
===== `sys.bladder.countdown`

[cols=">1h,1m"]
|===
| Type             | float
| User Modifiable  | 游린 false
| Synchronized     | 游린 false
| Expression Param | 游린 false
|===

Bladder fill countdown, the percentage of the bladder capacity remaining to be
filled.

[#param-fill-internal]
===== `sys.bladder.fill.volume.internal`

[cols=">1h,1m"]
|===
| Type             | float
| User Modifiable  | 游린 false
| Synchronized     | 游린 false
| Expression Param | 游린 false
|===

Internal system tracker for the current bladder fill percentage when taking the
selected max capacity into account.

[WARNING]
This value should not be exposed to the user, nor should it be visible in the
VRC expression parameters.


[#param-state]
===== `sys.bladder.state`

[cols=">1h,1m"]
|===
| Type             | int
| User Modifiable  | 游린 false
| Synchronized     | 游린 false
| Expression Param | 游린 false
|===

Internal system state enum.

[WARNING]
This value should not be exposed to the user, nor should it be visible in the
VRC expression parameters.

.Enum Values
* 0 = Disabled
* 1 = Filling
* 2 = Emptying Involuntarily
* 3 = Emptying Voluntarily

